# Confluence API - curl Connection Test

## Configuration

```bash
# Required Environment Variables
export CONFLUENCE_BASE_URL="https://your-company.atlassian.net"
export CONFLUENCE_EMAIL="your.email@example.com"
export CONFLUENCE_API_TOKEN="your_confluence_api_token_here"

# Alternative: Use Jira credentials (same Atlassian account)
# export JIRA_BASE_URL="https://your-company.atlassian.net"
# export JIRA_EMAIL="your.email@example.com"
# export JIRA_API_TOKEN="your_jira_api_token_here"

# Optional: Proxy Configuration
export HTTPS_PROXY="http://proxy.example.com:8080"
export HTTP_PROXY="http://proxy.example.com:8080"
```

## Authentication

Confluence Cloud uses **Basic Authentication** with the format:

```
Authorization: Basic base64(email:api_token)
```

## Base URL

```
https://your-company.atlassian.net
```

## Health Check Endpoint

```
GET /user/current
```

## curl Examples

### Basic Request (No Proxy)

```bash
curl -X GET "${CONFLUENCE_BASE_URL}/user/current" \
  -H "Accept: application/json" \
  -u "${CONFLUENCE_EMAIL}:${CONFLUENCE_API_TOKEN}"
```

### Request with Proxy

```bash
curl -X GET "${CONFLUENCE_BASE_URL}/user/current" \
  -H "Accept: application/json" \
  -u "${CONFLUENCE_EMAIL}:${CONFLUENCE_API_TOKEN}" \
  --proxy "${HTTPS_PROXY}"
```

### Request with Proxy (Insecure - Skip TLS Verification)

```bash
curl -X GET "${CONFLUENCE_BASE_URL}/user/current" \
  -H "Accept: application/json" \
  -u "${CONFLUENCE_EMAIL}:${CONFLUENCE_API_TOKEN}" \
  --proxy "${HTTPS_PROXY}" \
  --insecure
```

### Request with Custom CA Bundle

```bash
curl -X GET "${CONFLUENCE_BASE_URL}/user/current" \
  -H "Accept: application/json" \
  -u "${CONFLUENCE_EMAIL}:${CONFLUENCE_API_TOKEN}" \
  --proxy "${HTTPS_PROXY}" \
  --cacert /path/to/ca-bundle.crt
```

### Using Manual Base64 Encoding

```bash
# Create base64 encoded credentials
AUTH_HEADER=$(echo -n "${CONFLUENCE_EMAIL}:${CONFLUENCE_API_TOKEN}" | base64)

curl -X GET "${CONFLUENCE_BASE_URL}/user/current" \
  -H "Accept: application/json" \
  -H "Authorization: Basic ${AUTH_HEADER}"
```

## Sample API Calls

### List Spaces

```bash
curl -X GET "${CONFLUENCE_BASE_URL}/space" \
  -H "Accept: application/json" \
  -u "${CONFLUENCE_EMAIL}:${CONFLUENCE_API_TOKEN}"
```

### Get Space Details

```bash
curl -X GET "${CONFLUENCE_BASE_URL}/space/{spaceKey}" \
  -H "Accept: application/json" \
  -u "${CONFLUENCE_EMAIL}:${CONFLUENCE_API_TOKEN}"
```

### Search Content

```bash
curl -X GET "${CONFLUENCE_BASE_URL}/content/search?cql=type=page" \
  -H "Accept: application/json" \
  -u "${CONFLUENCE_EMAIL}:${CONFLUENCE_API_TOKEN}"
```

### Get Page Content

```bash
curl -X GET "${CONFLUENCE_BASE_URL}/content/{pageId}?expand=body.storage" \
  -H "Accept: application/json" \
  -u "${CONFLUENCE_EMAIL}:${CONFLUENCE_API_TOKEN}"
```

### Create Page

```bash
curl -X POST "${CONFLUENCE_BASE_URL}/content" \
  -H "Accept: application/json" \
  -H "Content-Type: application/json" \
  -u "${CONFLUENCE_EMAIL}:${CONFLUENCE_API_TOKEN}" \
  -d '{
    "type": "page",
    "title": "Test Page",
    "space": { "key": "MYSPACE" },
    "body": {
      "storage": {
        "value": "<p>Hello World</p>",
        "representation": "storage"
      }
    }
  }'
```

## Expected Response (Health Check)

```json
{
  "type": "known",
  "accountId": "123456:abcdef12-3456-7890-abcd-ef1234567890",
  "accountType": "atlassian",
  "email": "your.email@example.com",
  "publicName": "Your Name",
  "displayName": "Your Name"
}
```
